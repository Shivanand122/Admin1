
<style>
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Poppins', sans-serif;
        overflow: hidden;
    }

    .login-content h2 {
        margin: 15px 0;
        color: #333;
        text-transform: uppercase;
        font-size: 2.9rem;
    }

    .container {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .login-content {
        text-align: center;
        width: 400px; /* Adjust the width as needed */
        
    }

        .login-content img {
            height: 100px;
        }

        .login-content h2 {
            margin: 15px 0;
            color: #333;
            text-transform: uppercase;
            font-size: 2.9rem;
        }

    .input-div {
        position: relative;
        margin: 25px 0;
        padding: 5px 0;
        border-bottom: 2px solid #d9d9d9;
    }

        .input-div > div {
            display: flex;
            align-items: center;
        }

            .input-div > div > h5 {
                position: absolute;
                left: 10px;
                top: 50%;
                transform: translateY(-50%);
                color: #999;
                font-size: 18px;
                transition: .3s;
            }

        .input-div:before,
        .input-div:after {
            content: '';
            position: absolute;
            bottom: -2px;
            width: 100%;
            height: 2px;
            background-color: #38d39f;
            transition: .4s;
        }

        .input-div:before {
            right: 0%;
        }

        .input-div:after {
            left: 0%;
        }

        .input-div > div.focus:before,
        .input-div.focus:after {
            width: 100%;
        }

        .input-div.focus > div > h5 {
            top: -5px;
            font-size: 15px;
        }

        .input-div.focus > .i > i {
            color: #38d39f;
        }

    .i {
        color: #38d39f;
    }

    .input-div > div > input {
        width: 100%;
        height: 100%;
        border: none;
        outline: none;
        background: none;
        padding: 0.5rem 0.7rem;
        font-size: 1.2rem;
        color: #555;
        font-family: 'poppins', sans-serif;
        margin-left: 10px;
    }

    a {
        display: block;
        text-align: right;
        text-decoration: none;
        color: #999;
        font-size: 0.9rem;
        transition: .3s;
    }

        a:hover {
            color: #38d39f;
        }

    .btn {
        display: block;
        width: 100%;
        height: 50px;
        border-radius: 25px;
        outline: none;
        border: none;
        background-image: linear-gradient(to right, #32be8f, #38d39f, #32be8f);
        background-size: 200%;
        font-size: 1.2rem;
        color: #fff;
        font-family: 'Poppins', sans-serif;
        text-transform: uppercase;
        margin: 1rem 0;
        cursor: pointer;
        transition: .5s;
    }

    .input-div > div > i {
        margin-right: 10px;
        vertical-align: middle;
        color: #999;
        font-size: 18px;
        transition: .3s;
    }

    .btn:hover {
        background-position: right;
    }
</style>

<link href="https://fonts.googleapis.com/css?family=Poppins:600&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/a81368914c.js"></script>

<div class="container">
    <div class="login-content">
        <form onclick="return validate()">
            
            <!-- Existing login form code here -->
            <!-- New verification code section -->
            <div class="auth">
                <h2 class="title">VERIFY OTP</h2>

            </div>

            <p>Verification code has been sent to the registered Email</p>

            <div class="card verification-card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="form-group">
                                <label>OTP</label>
                                <input type="text" class="form-control" id="txtotp" style="border: 1px solid black;" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <br />

            <div class="card-footer">
                <a onclick="ProceedVerify()" class="btn btn-primary">Verify</a>
            </div>

        </form>
    </div>
</div>

@* 
<div class="auth"><h1>AUTHENTICATION</h1></div>

<h5>Verification code has been sent to the registered Email</h5>

<div class="card">

    <div class="card-body">

        <div class="row">

            <div class="col-lg-12">

                <div class="form-group">

                    <label>OTP</label>

                    <input type="text" class="form-control" id="txtotp" style="border:1px solid black" />

                </div>

            </div>

        </div>

    </div>

</div>

<br />

<div class="card-footer">

    <a onclick="ProceedVerify()" class="btn btn-primary">Verify</a>

</div> *@

<p class="succ-msg" id="succmsg" style="color:red"></p>

<!-- Add this div for displaying the warning message -->

<div class="warning-msg" id="warning-msg"></div>

@* <script src="/js/CaptchaJavaScript.js"></script>
 *@
<script src="~/lib/jquery/dist/jquery.min.js"></script>

<script type="text/javascript">

    var js = jQuery.noConflict(true);


    // Revised ProceedVerify function

    function ProceedVerify() {

        var isproceed = true;

        var urlParams = new URLSearchParams(window.location.search);

        var user = urlParams.get('username');

        var _otp = $('#txtotp');

        var otp = _otp.val();

        if (otp == null || otp.trim() == '') {

            _otp.css('border-color', 'red');

            isproceed = false;

        } else {

            _otp.css('border-color', '#ccc');

        }

        if (isproceed) {

            var succmsg = document.getElementById('succmsg');

            var _obj = {

                username: user,

                code: otp

            };

            $.ajax({

                type: 'POST',

                url: 'https://usermanagementapi-team4.azurewebsites.net/api/Authentication/login-2FA',

                data: JSON.stringify(_obj),

                contentType: 'application/json; charset=utf-8',

                dataType: 'json',

                success: function (data) {

                    if (data && data.token) {

                        // var identity = (ClaimsIdentity)User.Identity;
                        // identity.AddClaim(new Claim("Has2FA", "true"));

                        localStorage.setItem('token', data.token);


                        window.location.href = '/AdminM/Index';
                        // if (data.role === 'Admin') {

                        //     // Redirect to the next page for SuperAdmin

                        //     window.location.href = '/User/Index';

                        // } else {

                        //     window.location.href = '/Login/Index';

                        //     succmsg.textContent = 'Access denied. User is not a Super Admin';

                        //     return false;

                        // }

                    } else {

                        // Handle other scenarios or errors

                    }

                },

                error: function (xhr, textStatus, errorThrown) {

                    // Display error message on the page

                    alert('Invalid verification Code.');

                    window.location.href = '/AdminM/Log';

                    succmsg.textContent = 'Invalid Verification Code.';

                    return false;

                }

            });

        }

    }

</script>
